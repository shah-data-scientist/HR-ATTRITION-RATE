## Issue Export: FastAPI Prediction Endpoint Body Parsing Error

**Problem:**
The FastAPI `/predict` endpoint is returning a `422 Unprocessable Entity` error with the detail message `"There was an error parsing the body"` when attempting to send a prediction request using PowerShell's `Invoke-RestMethod`.

**Context:**
*   **Application:** FastAPI application for employee attrition prediction.
*   **Endpoint:** `POST /predict`
*   **Expected Request Body:** Conforms to the `BatchPredictionInput` Pydantic schema, which expects a JSON object with a key `employees` containing a list of `EmployeeFeatures` objects. Each `EmployeeFeatures` object has numerous fields (e.g., `id_employee`, `age`, `revenu_mensuel`, `statut_marital`, etc.).
*   **FastAPI Application Status:** The application is confirmed to be running successfully (Uvicorn started, model loaded).
*   **Previous Attempts:**
    *   Initial attempts to send the request using `curl` directly in PowerShell failed due to PowerShell's interpretation of multi-line `curl` syntax.
    *   A subsequent attempt using `Invoke-RestMethod` with a PowerShell hashtable converted to JSON via `ConvertTo-Json` also resulted in the `422` error.

**PowerShell Command Attempt (that failed with "There was an error parsing the body"):**

```powershell
$employee1 = @{
    id_employee = 1
    age = 35
    genre = 1
    revenu_mensuel = 6000.0
    statut_marital = "Marié"
    departement = "R&D"
    poste = "Développeur"
    nombre_experiences_precedentes = 2
    annee_experience_totale = 10
    annees_dans_l_entreprise = 5
    annees_dans_le_poste_actuel = 3
    nombre_participation_pee = 1
    nb_formations_suivies = 2
    nombre_employee_sous_responsabilite = 0
    distance_domicile_travail = 15
    niveau_education = 3
    domaine_etude = "Informatique"
    ayant_enfants = 1
    frequence_deplacement = "Rarement"
    annees_depuis_la_derniere_promotion = 2
    annes_sous_responsable_actuel = 2
    satisfaction_employee_environnement = 3
    note_evaluation_precedente = 3.5
    niveau_hierarchique_poste = 2
    satisfaction_employee_nature_travail = 4
    satisfaction_employee_equipe = 3
    satisfaction_employee_equilibre_pro_perso = 3
    note_evaluation_actuelle = 4.0
    heures_supplementaires = 0
    augementation_salaire_precedente = 0.07
}

$employee2 = @{
    id_employee = 9999
    age = 28
    genre = 0
    revenu_mensuel = 4500.0
    statut_marital = "Célibataire"
    departement = "Ventes"
    poste = "Commercial"
    nombre_experiences_precedentes = 1
    annee_experience_totale = 4
    annees_dans_l_entreprise = 2
    annees_dans_le_poste_actuel = 2
    nombre_participation_pee = 0
    nb_formations_suivies = 1
    nombre_employee_sous_responsabilite = 0
    distance_domicile_travail = 5
    niveau_education = 2
    domaine_etude = "Marketing"
    ayant_enfants = 0
    frequence_deplacement = "Fréquemment"
    annees_depuis_la_derniere_promotion = 1
    annes_sous_responsable_actuel = 1
    satisfaction_employee_environnement = 4
    note_evaluation_precedente = 3.0
    niveau_hierarchique_poste = 1
    satisfaction_employee_nature_travail = 3
    satisfaction_employee_equipe = 4
    satisfaction_employee_equilibre_pro_perso = 4
    note_evaluation_actuelle = 3.5
    heures_supplementaires = 1
    augementation_salaire_precedente = 0.05
}

$body = @{
    employees = @($employee1, $employee2)
} | ConvertTo-Json -Depth 10 # Use -Depth to ensure nested objects are fully converted

Invoke-RestMethod -Uri "http://127.0.0.1:8000/predict" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

**Hypothesis for the root cause:**
The most likely reason for the `"There was an error parsing the body"` message is that the JSON string generated by PowerShell's `ConvertTo-Json` (or the way it's being passed) does not precisely match the `BatchPredictionInput` Pydantic schema expected by the FastAPI endpoint. This could be due to:
*   Subtle differences in data types (e.g., PowerShell converting integers to floats, or vice-versa, that Pydantic then rejects).
*   Incorrect nesting or structure of the JSON.
*   Missing required fields that `ConvertTo-Json` might omit if they are `null` or `None` in the PowerShell object.

**Recommended Next Step (for the other AI):**
The most robust way to debug this is to:
1.  **Use FastAPI's interactive Swagger UI (`http://127.0.0.1:8000/docs`)** to send a request to the `/predict` endpoint. The Swagger UI automatically generates a valid JSON body based on the API's schema.
2.  **If the Swagger UI request succeeds**, then the problem is definitively with how PowerShell is constructing and sending the JSON body. The other AI can then focus on refining the PowerShell `Invoke-RestMethod` command to produce a JSON body identical to what Swagger UI sends.
3.  **If the Swagger UI request also fails**, then there might be a deeper issue within the FastAPI application's Pydantic schema definition or its parsing logic.

**Relevant Files:**
*   `api/app/main.py` (FastAPI application logic)
*   `api/app/schemas.py` (Pydantic schemas: `EmployeeFeatures`, `BatchPredictionInput`, `PredictionOutput`, `BatchPredictionOutput`)
*   `database/models.py` (SQLAlchemy models for database interaction)
*   `database/database.py` (Database connection setup)
*   `utils.py` (Data cleaning and feature engineering functions)

This export summarizes the current state and the problem for you to share with another AI.