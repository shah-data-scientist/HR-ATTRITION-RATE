# Database Schema Description

This document outlines the database schema designed for the HR Attrition Rate project, focusing on employee data, machine learning model inputs, model outputs, and prediction traceability. The schema is implemented using SQLAlchemy ORM.

## Entities (Tables)

### 1. `employees` Table

Stores comprehensive data for each employee.

*   **`id_employee`** (Integer, Primary Key, Indexed): Unique identifier for the employee.
*   **`augmentation_salaire_precedente`** (Float, Nullable): Previous salary increase percentage.
*   **`heures_supplementaires`** (Integer, Nullable): Indicator for overtime (e.g., 0 for No, 1 for Yes).
*   **`genre`** (Integer, Nullable): Employee's gender (e.g., 0 for Female, 1 for Male).
*   **`nombre_heures_travailless`** (Float, Nullable): Number of hours worked.
*   **`note_evaluation_actuelle`** (Float, Nullable): Current evaluation score.
*   **`note_evaluation_precedente`** (Float, Nullable): Previous evaluation score.
*   **`satisfaction_employee_nature_travail`** (Float, Nullable): Employee satisfaction with work nature.
*   **`satisfaction_employee_equipe`** (Float, Nullable): Employee satisfaction with team.
*   **`satisfaction_employee_equilibre_pro_perso`** (Float, Nullable): Employee satisfaction with work-life balance.
*   **`annees_dans_le_poste_actuel`** (Float, Nullable): Years in current role.
*   **`annees_dans_l_entreprise`** (Float, Nullable): Years in the company.
*   **`date_ingestion`** (DateTime, Timezone=True, Server Default=Current Timestamp): Timestamp when the employee record was ingested.

### 2. `model_inputs` Table

Records the specific features (inputs) used for each prediction request to the machine learning model.

*   **`input_id`** (Integer, Primary Key, Indexed): Unique identifier for the model input record.
*   **`id_employee`** (Integer, Foreign Key to `employees.id_employee`, Not Null): Links the input to a specific employee.
*   **`prediction_timestamp`** (DateTime, Timezone=True, Server Default=Current Timestamp): Timestamp when the prediction request was made.
*   **`features`** (JSON, Not Null): A JSON object containing all the feature values used as input for the model. This allows for flexible storage of varying feature sets.

### 3. `model_outputs` Table

Stores the results (outputs) generated by the machine learning model for each prediction.

*   **`output_id`** (Integer, Primary Key, Indexed): Unique identifier for the model output record.
*   **`prediction_proba`** (Float, Not Null): The raw probability score generated by the model (e.g., probability of attrition).
*   **`risk_category`** (String, Not Null): Categorical risk level derived from the prediction probability (e.g., "Low", "Medium", "High").
*   **`prediction_label`** (String, Not Null): The final prediction label (e.g., "Stay", "Leave").
*   **`log_odds`** (Float, Not Null): The log-odds score from the model, often used in SHAP explanations.
*   **`prediction_timestamp`** (DateTime, Timezone=True, Server Default=Current Timestamp): Timestamp when the model output was generated.

### 4. `predictions_traceability` Table

Provides a link between model inputs and outputs, ensuring complete traceability for each prediction event.

*   **`trace_id`** (Integer, Primary Key, Indexed): Unique identifier for the prediction traceability record.
*   **`input_id`** (Integer, Foreign Key to `model_inputs.input_id`, Not Null): Links to the specific model input used.
*   **`output_id`** (Integer, Foreign Key to `model_outputs.output_id`, Not Null): Links to the specific model output generated.
*   **`model_version`** (String, Nullable): Identifier for the version of the machine learning model used for the prediction.
*   **`prediction_source`** (String, Nullable): Describes where the prediction request originated (e.g., "API", "Batch Process", "UI").
*   **`request_metadata`** (JSON, Nullable): Additional metadata about the prediction request (e.g., user ID, request ID, specific parameters).
*   **`created_at`** (DateTime, Timezone=True, Server Default=Current Timestamp): Timestamp when this traceability record was created.

## Relationships

*   **`employees` to `model_inputs`**: One-to-Many. An employee can have multiple model input records (each time a prediction is made for them).
*   **`model_inputs` to `predictions_traceability`**: One-to-One. Each model input corresponds to exactly one traceability record.
*   **`model_outputs` to `predictions_traceability`**: One-to-One. Each model output corresponds to exactly one traceability record.

This schema ensures that every prediction made by the model is fully traceable back to the employee data, the exact features used, the model's output, and contextual information about the prediction event.